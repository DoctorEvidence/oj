<!DOCTYPE html>

<html>
<head>
  <title>qbTableGrid.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="sqlBuilderInit.html">
                sqlBuilderInit.js
              </a>
            
              
              <a class="source" href="SqlDragDropTableJoinStore.html">
                SqlDragDropTableJoinStore.js
              </a>
            
              
              <a class="source" href="SqlTableJoinSprite.html">
                SqlTableJoinSprite.js
              </a>
            
              
              <a class="source" href="SqlTableNameStore.html">
                SqlTableNameStore.js
              </a>
            
              
              <a class="source" href="_initQbUI.html">
                _initQbUI.js
              </a>
            
              
              <a class="source" href="qbFineTuningGrid.html">
                qbFineTuningGrid.js
              </a>
            
              
              <a class="source" href="qbOutputPanel.html">
                qbOutputPanel.js
              </a>
            
              
              <a class="source" href="qbSqlWindowTable.html">
                qbSqlWindowTable.js
              </a>
            
              
              <a class="source" href="qbTableGrid.html">
                qbTableGrid.js
              </a>
            
              
              <a class="source" href="qbTablePanel.html">
                qbTablePanel.js
              </a>
            
              
              <a class="source" href="qbTablesTree.html">
                qbTablesTree.js
              </a>
            
              
              <a class="source" href="fields.html">
                fields.js
              </a>
            
              
              <a class="source" href="joins.html">
                joins.js
              </a>
            
              
              <a class="source" href="manager.html">
                manager.js
              </a>
            
              
              <a class="source" href="select.html">
                select.js
              </a>
            
              
              <a class="source" href="tables.html">
                tables.js
              </a>
            
              
              <a class="source" href="function.html">
                function.js
              </a>
            
              
              <a class="source" href="is.html">
                is.js
              </a>
            
              
              <a class="source" href="methods.html">
                methods.js
              </a>
            
              
              <a class="source" href="number.html">
                number.js
              </a>
            
              
              <a class="source" href="string.html">
                string.js
              </a>
            
              
              <a class="source" href="to.html">
                to.js
              </a>
            
              
              <a class="source" href="indexedDb.html">
                indexedDb.js
              </a>
            
              
              <a class="source" href="class.html">
                class.js
              </a>
            
              
              <a class="source" href="classDefinition.html">
                classDefinition.js
              </a>
            
              
              <a class="source" href="errors.html">
                errors.js
              </a>
            
              
              <a class="source" href="subscribers.html">
                subscribers.js
              </a>
            
              
              <a class="source" href="console.html">
                console.js
              </a>
            
              
              <a class="source" href="constant.html">
                constant.js
              </a>
            
              
              <a class="source" href="each.html">
                each.js
              </a>
            
              
              <a class="source" href="object.html">
                object.js
              </a>
            
              
              <a class="source" href="objectSql.html">
                objectSql.js
              </a>
            
              
              <a class="source" href="property.html">
                property.js
              </a>
            
              
              <a class="source" href="shims.html">
                shims.js
              </a>
            
              
              <a class="source" href="uuid.html">
                uuid.js
              </a>
            
              
              <a class="source" href="metaNode.html">
                metaNode.js
              </a>
            
              
              <a class="source" href="_nodeFactory.html">
                _nodeFactory.js
              </a>
            
              
              <a class="source" href="domNode.html">
                domNode.js
              </a>
            
              
              <a class="source" href="domNodeAttributes.html">
                domNodeAttributes.js
              </a>
            
              
              <a class="source" href="_element.html">
                _element.js
              </a>
            
              
              <a class="source" href="div.html">
                div.js
              </a>
            
              
              <a class="source" href="span.html">
                span.js
              </a>
            
              
              <a class="source" href="initChildNameSpaces.html">
                initChildNameSpaces.js
              </a>
            
              
              <a class="source" href="dataModel.html">
                dataModel.js
              </a>
            
              
              <a class="source" href="dataType.html">
                dataType.js
              </a>
            
              
              <a class="source" href="dataTypeCollection.html">
                dataTypeCollection.js
              </a>
            
              
              <a class="source" href="_selectionModel.html">
                _selectionModel.js
              </a>
            
              
              <a class="source" href="selectionModelCheckBox.html">
                selectionModelCheckBox.js
              </a>
            
              
              <a class="source" href="_selectionSubscribers.html">
                _selectionSubscribers.js
              </a>
            
              
              <a class="source" href="onDeselect.html">
                onDeselect.js
              </a>
            
              
              <a class="source" href="onSelect.html">
                onSelect.js
              </a>
            
              
              <a class="source" href="proxy.html">
                proxy.js
              </a>
            
              
              <a class="source" href="store.html">
                store.js
              </a>
            
              
              <a class="source" href="actionColumn.html">
                actionColumn.js
              </a>
            
              
              <a class="source" href="checkColumn.html">
                checkColumn.js
              </a>
            
              
              <a class="source" href="column.html">
                column.js
              </a>
            
              
              <a class="source" href="columnItem.html">
                columnItem.js
              </a>
            
              
              <a class="source" href="columns.html">
                columns.js
              </a>
            
              
              <a class="source" href="gridColumn.html">
                gridColumn.js
              </a>
            
              
              <a class="source" href="rendererColumn.html">
                rendererColumn.js
              </a>
            
              
              <a class="source" href="grid.html">
                grid.js
              </a>
            
              
              <a class="source" href="_gridSubscribers.html">
                _gridSubscribers.js
              </a>
            
              
              <a class="source" href="bodyscroll.html">
                bodyscroll.js
              </a>
            
              
              <a class="source" href="drop.html">
                drop.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="panel.html">
                panel.js
              </a>
            
              
              <a class="source" href="_panelSubscribers.html">
                _panelSubscribers.js
              </a>
            
              
              <a class="source" href="afterLayout.html">
                afterLayout.js
              </a>
            
              
              <a class="source" href="sheet.html">
                sheet.js
              </a>
            
              
              <a class="source" href="_sheetSubscribers.html">
                _sheetSubscribers.js
              </a>
            
              
              <a class="source" href="beforeclose.html">
                beforeclose.js
              </a>
            
              
              <a class="source" href="beforeshow.html">
                beforeshow.js
              </a>
            
              
              <a class="source" href="show.html">
                show.js
              </a>
            
              
              <a class="source" href="_structureSet.html">
                _structureSet.js
              </a>
            
              
              <a class="source" href="structureSet.html">
                structureSet.js
              </a>
            
              
              <a class="source" href="_treeSubscribers.html">
                _treeSubscribers.js
              </a>
            
              
              <a class="source" href="afterrender.html">
                afterrender.js
              </a>
            
              
              <a class="source" href="itemdbclick.html">
                itemdbclick.js
              </a>
            
              
              <a class="source" href="tree.html">
                tree.js
              </a>
            
              
              <a class="source" href="treeNode.html">
                treeNode.js
              </a>
            
              
              <a class="source" href="treeStore.html">
                treeStore.js
              </a>
            
              
              <a class="source" href="nameSpace.html">
                nameSpace.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>qbTableGrid.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/* jshint undef: true, unused: true */</span>
<span class="comment">/* global n$:true, window:true, Ext:true, $: true */</span>

(<span class="function"><span class="keyword">function</span> <span class="params">(n$)</span> {</span>

    <span class="keyword">var</span> onInit = <span class="function"><span class="keyword">function</span> <span class="params">(thisGrid)</span> {</span>
        thisGrid.columns = [n$.grids.columns.rendererColumn({
            width: <span class="number">16</span>,
            dataIndex: <span class="string">'key'</span>,
            onRender: <span class="function"><span class="keyword">function</span> <span class="params">(val, meta, model)</span> {</span>
                <span class="keyword">if</span> (val == <span class="string">'PRI'</span>) {
                    meta.style = <span class="string">'background-image:url(img/key.gif) !important;background-position:2px 3px;background-repeat:no-repeat;'</span>;
                }
                <span class="keyword">return</span> <span class="string">'&amp;nbsp;'</span>;
            }
        }),
            n$.grids.columns.rendererColumn({
                flex: <span class="number">1</span>,
                dataIndex: <span class="string">'field'</span>,
                onRender: <span class="function"><span class="keyword">function</span> <span class="params">(val, meta, model)</span> {</span>
                    <span class="keyword">if</span> (model.get(<span class="string">'key'</span>) == <span class="string">'PRI'</span>) {
                        <span class="keyword">return</span> <span class="string">'&lt;span style="font-weight: bold;"&gt;'</span> + val + <span class="string">'&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span style="color:#aaa;"&gt;'</span> + model.get(<span class="string">'type'</span>) + <span class="string">'&lt;/span&gt;'</span>;
                    }
                    <span class="keyword">return</span> val + <span class="string">'&amp;nbsp;&amp;nbsp;&lt;span style="color:#999;"&gt;'</span> + model.get(<span class="string">'type'</span>) + <span class="string">'&lt;/span&gt;'</span>;

                }
            })];


        <span class="keyword">var</span> model;
        <span class="keyword">var</span> selModel = n$.dataSelections.selectionModelCheckBox({
            name: <span class="string">'qbTableGridSelectionModelCheckBox'</span>,
            checkOnly: <span class="literal">true</span>,
            onDefine: <span class="keyword">function</span>(def, that) {
                that.subscribers.add(that.subs.select, <span class="function"><span class="keyword">function</span> <span class="params">(sModel, data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>add new rows to the qbFineTuningGrid after a selection change</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    n$.actions.sql.manager.select.fields.addFieldRecord(data, <span class="literal">true</span>);
                });
                that.subscribers.add(that.subs.deselect, <span class="function"><span class="keyword">function</span> <span class="params">(sModel, data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>remove row from qbFineTuningGrid after deselection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    n$.actions.sql.manager.select.fields.removeFieldById(data.get(<span class="string">'id'</span>));
                });
                model = window.Ext.create(<span class="string">'Ext.selection.CheckboxModel'</span>, def);
            }
        });

        thisGrid.selModel = model;

        <span class="keyword">return</span> thisGrid;
    };

    <span class="comment">/**
     * Define the grid
    */</span>
    <span class="keyword">var</span> grid = n$.grids.grid({
        name: <span class="string">'Ext.'</span> + n$.name + <span class="string">'.qbTableGrid'</span>,
        alias: [<span class="string">'widget.qbTableGrid'</span>],
        onInit: onInit
    });

    grid.addProp(n$.grids.constants.properties.hideHeaders, <span class="literal">true</span>);
    grid.addProp(n$.grids.constants.properties.border, <span class="literal">false</span>);


    <span class="comment">/**
     * Add the subscribers
    */</span>
    grid.subscribers.add(n$.grids.constants.subscribers.bodyscroll, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
        <span class="keyword">var</span> scrollOffset, qbSqlWindowTable;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>the bodyscroll event of the view was fired
get scroll information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scrollOffset = <span class="keyword">this</span>.el.getScroll();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>get the parent qbSqlWindowTable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        qbSqlWindowTable = <span class="keyword">this</span>.up(<span class="string">'qbSqlWindowTable'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>change shadowSprites scrollTop property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        qbSqlWindowTable.shadowSprite.scrollTop = scrollOffset.top;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>redraw all connections to reflect scroll action</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">for</span> (<span class="keyword">var</span> i = n$.actions.sql.manager.connections.length; i--;) {
            qbSqlWindowTable.connection(n$.actions.sql.manager.connections[i]);
        }
    });

    grid.subscribers.add(n$.grids.constants.subscribers.render, <span class="function"><span class="keyword">function</span> <span class="params">(view)</span> {</span>
        <span class="keyword">this</span>.dd = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>init the view as a DragZone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.dd.dragZone = <span class="keyword">new</span> Ext.view.DragZone({
            view: view,
            ddGroup: <span class="string">'SQLTableGridDDGroup'</span>,
            dragText: <span class="string">'{0} selected table column{1}'</span>,
            onInitDrag: <span class="function"><span class="keyword">function</span> <span class="params">(x, y)</span> {</span>
                <span class="keyword">var</span> me = <span class="keyword">this</span>,
                    data = me.dragData,
                    view = data.view,
                    selectionModel = view.getSelectionModel(),
                    record = view.getRecord(data.item),
                    e = data.event;
                data.records = [record];
                me.ddel.update(me.getDragText());
                me.proxy.update(me.ddel.dom);
                me.onStartDrag(x, y);
                <span class="keyword">return</span> <span class="literal">true</span>;
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>init the view as a DropZone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.dd.dropZone = <span class="keyword">new</span> Ext.grid.ViewDropZone({
            view: view,
            ddGroup: <span class="string">'SQLTableGridDDGroup'</span>,
            handleNodeDrop: <span class="function"><span class="keyword">function</span> <span class="params">(data, record, position)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Was soll nach dem Drop passieren?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            },
            onNodeOver: <span class="function"><span class="keyword">function</span> <span class="params">(node, dragZone, e, data)</span> {</span>
                <span class="keyword">var</span> me = <span class="keyword">this</span>,
                    view = me.view,
                    pos = me.getPosition(e, node),
                    overRecord = view.getRecord(node),
                    draggingRecords = data.records;

                <span class="keyword">if</span> (!Ext.Array.contains(data.records, me.view.getRecord(node))) {
                    <span class="keyword">if</span> (!Ext.Array.contains(draggingRecords, overRecord) &amp;&amp; data.records[<span class="number">0</span>].get(<span class="string">'field'</span>) != <span class="string">'*'</span>) {
                        me.valid = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>valid drop target
todo show drop invitation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>invalid drop target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        me.valid = <span class="literal">false</span>;
                    }
                }
                <span class="keyword">return</span> me.valid ? me.dropAllowed : me.dropNotAllowed;
            },
            onContainerOver: <span class="function"><span class="keyword">function</span> <span class="params">(dd, e, data)</span> {</span>
                <span class="keyword">var</span> me = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>invalid drop target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                me.valid = <span class="literal">false</span>;
                <span class="keyword">return</span> me.dropNotAllowed;
            }
        });
    });

    grid.subscribers.add(n$.grids.constants.subscribers.drop, <span class="function"><span class="keyword">function</span> <span class="params">(node, data, dropRec, dropPosition)</span> {</span>
        <span class="keyword">var</span> sqlTable1, sqlTable2, showJoinCM, connection, aBBPos, join, joinCondition = <span class="string">''</span>,
            dropTable, targetTable;

        showJoinCM = <span class="function"><span class="keyword">function</span> <span class="params">(event, el)</span> {</span>
            <span class="keyword">var</span> cm;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>stop the browsers event bubbling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            event.stopEvent();</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>create context menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cm = Ext.create(<span class="string">'Ext.menu.Menu'</span>, {
                items: [{
                    text: <span class="string">'Edit Join'</span>,
                    icon: <span class="string">'resources/images/document_edit16x16.gif'</span>,
                    handler: Ext.Function.bind(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
                        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Edit Join has not been implemented.'</span>);
                    }, <span class="keyword">this</span>)
                }, {
                    text: <span class="string">'Remove Join'</span>,
                    icon: <span class="string">'resources/images/remove.gif'</span>,
                    handler: Ext.Function.bind(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>remove any connection lines from surface and from array n$.actions.sql.manager.connections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        n$.actions.sql.manager.connections = Ext.Array.filter(n$.actions.sql.manager.connections, <span class="function"><span class="keyword">function</span> <span class="params">(connection)</span> {</span>
                            <span class="keyword">var</span> bRemove = <span class="literal">true</span>;
                            <span class="keyword">if</span> (<span class="keyword">this</span>.uuid == connection.uuid) {
                                <span class="keyword">this</span>.line.remove();
                                <span class="keyword">this</span>.bgLine.remove();
                                <span class="keyword">this</span>.miniLine1.remove();
                                <span class="keyword">this</span>.miniLine2.remove();
                                bRemove = <span class="literal">false</span>;
                            }
                            <span class="keyword">return</span> bRemove;
                        }, <span class="keyword">this</span>);
                        n$.actions.sql.manager.select.joins.removeJoinById(<span class="keyword">this</span>.uuid);
                    }, <span class="keyword">this</span>)
                }, {
                    text: <span class="string">'Close Menu'</span>,
                    icon: <span class="string">'resources/images/cross.gif'</span>,
                    handler: Ext.emptyFn
                }]
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>show the contextmenu next to current mouse position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cm.showAt(event.getXY());
        };

        <span class="keyword">if</span> (node.boundView) {
            sqlTable1 = data.view.up(<span class="string">'window'</span>);
            sqlTable1.shadowSprite.bConnections = <span class="literal">true</span>;

            sqlTable2 = Ext.getCmp(node.boundView).up(<span class="string">'window'</span>);
            sqlTable2.shadowSprite.bConnections = <span class="literal">true</span>;

            dropTable = n$.actions.sql.manager.select.tables.getTableById(sqlTable1.tableId);
            targetTable = n$.actions.sql.manager.select.tables.getTableById(sqlTable2.tableId);

            aBBPos = [data.item.viewIndex, node.viewIndex];

            connection = sqlTable2.connection(sqlTable2, sqlTable1.shadowSprite, sqlTable2.shadowSprite, <span class="string">"#000"</span>, aBBPos);

            sqlTable1.connectionUUIDs.push(connection.uuid);
            sqlTable2.connectionUUIDs.push(connection.uuid);

            n$.actions.sql.manager.connections.push(connection);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>bgLine is white(invisble) and its stroke-width is 10
so it is easier to capture the dblclick event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            connection.bgLine.el.on(<span class="string">'contextmenu'</span>, showJoinCM, connection);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>line is black and its stroke-width is 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            connection.line.el.on(<span class="string">'contextmenu'</span>, showJoinCM, connection);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>create an instance of the join model
join = Ext.create(&#39;Ext.&#39; + n$.name + &#39;.SqlDragDropTableJoinModel&#39;);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join = <span class="keyword">new</span> n$.actions.querybuilder.SqlDragDropTableJoinModel();</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>set join id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'id'</span>, connection.uuid);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>sqlTable1 is the left table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'leftTableId'</span>, sqlTable1.tableId);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>data.records[0] represents the model of the dragged node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'leftTableField'</span>, data.records[<span class="number">0</span>].get(<span class="string">'field'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>sqlTable1 is the left table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'rightTableId'</span>, sqlTable2.tableId);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>node.viewIndex is the index of the target node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'rightTableField'</span>, sqlTable2.down(<span class="string">'grid'</span>).store.getAt(node.viewIndex).get(<span class="string">'field'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>set the defaul join type to INNER</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'joinType'</span>, <span class="string">'INNER'</span>);

            <span class="keyword">if</span> (dropTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                joinCondition = joinCondition + dropTable.get(<span class="string">'tableAlias'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'leftTableField'</span>) + <span class="string">'='</span>;
            } <span class="keyword">else</span> {
                joinCondition = joinCondition + dropTable.get(<span class="string">'tableName'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'leftTableField'</span>) + <span class="string">'='</span>;
            }

            <span class="keyword">if</span> (targetTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                joinCondition = joinCondition + targetTable.get(<span class="string">'tableAlias'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'rightTableField'</span>);
            } <span class="keyword">else</span> {
                joinCondition = joinCondition + targetTable.get(<span class="string">'tableName'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'rightTableField'</span>);
            }

            join.set(<span class="string">'joinCondition'</span>, joinCondition);
            n$.actions.sql.manager.select.joins.addJoin(join);
        }

    });

    grid.init();

}(window.$nameSpace$));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
