<!DOCTYPE html>

<html>
<head>
  <title>select.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="sqlBuilderInit.html">
                sqlBuilderInit.js
              </a>
            
              
              <a class="source" href="SqlDragDropTableJoinStore.html">
                SqlDragDropTableJoinStore.js
              </a>
            
              
              <a class="source" href="SqlTableJoinSprite.html">
                SqlTableJoinSprite.js
              </a>
            
              
              <a class="source" href="SqlTableNameStore.html">
                SqlTableNameStore.js
              </a>
            
              
              <a class="source" href="_initQbUI.html">
                _initQbUI.js
              </a>
            
              
              <a class="source" href="qbFineTuningGrid.html">
                qbFineTuningGrid.js
              </a>
            
              
              <a class="source" href="qbOutputPanel.html">
                qbOutputPanel.js
              </a>
            
              
              <a class="source" href="qbSqlWindowTable.html">
                qbSqlWindowTable.js
              </a>
            
              
              <a class="source" href="qbTableGrid.html">
                qbTableGrid.js
              </a>
            
              
              <a class="source" href="qbTablePanel.html">
                qbTablePanel.js
              </a>
            
              
              <a class="source" href="qbTablesTree.html">
                qbTablesTree.js
              </a>
            
              
              <a class="source" href="fields.html">
                fields.js
              </a>
            
              
              <a class="source" href="joins.html">
                joins.js
              </a>
            
              
              <a class="source" href="manager.html">
                manager.js
              </a>
            
              
              <a class="source" href="select.html">
                select.js
              </a>
            
              
              <a class="source" href="tables.html">
                tables.js
              </a>
            
              
              <a class="source" href="function.html">
                function.js
              </a>
            
              
              <a class="source" href="is.html">
                is.js
              </a>
            
              
              <a class="source" href="methods.html">
                methods.js
              </a>
            
              
              <a class="source" href="number.html">
                number.js
              </a>
            
              
              <a class="source" href="string.html">
                string.js
              </a>
            
              
              <a class="source" href="to.html">
                to.js
              </a>
            
              
              <a class="source" href="indexedDb.html">
                indexedDb.js
              </a>
            
              
              <a class="source" href="class.html">
                class.js
              </a>
            
              
              <a class="source" href="classDefinition.html">
                classDefinition.js
              </a>
            
              
              <a class="source" href="errors.html">
                errors.js
              </a>
            
              
              <a class="source" href="subscribers.html">
                subscribers.js
              </a>
            
              
              <a class="source" href="console.html">
                console.js
              </a>
            
              
              <a class="source" href="constant.html">
                constant.js
              </a>
            
              
              <a class="source" href="each.html">
                each.js
              </a>
            
              
              <a class="source" href="object.html">
                object.js
              </a>
            
              
              <a class="source" href="objectSql.html">
                objectSql.js
              </a>
            
              
              <a class="source" href="property.html">
                property.js
              </a>
            
              
              <a class="source" href="shims.html">
                shims.js
              </a>
            
              
              <a class="source" href="uuid.html">
                uuid.js
              </a>
            
              
              <a class="source" href="metaNode.html">
                metaNode.js
              </a>
            
              
              <a class="source" href="_nodeFactory.html">
                _nodeFactory.js
              </a>
            
              
              <a class="source" href="domNode.html">
                domNode.js
              </a>
            
              
              <a class="source" href="domNodeAttributes.html">
                domNodeAttributes.js
              </a>
            
              
              <a class="source" href="_element.html">
                _element.js
              </a>
            
              
              <a class="source" href="div.html">
                div.js
              </a>
            
              
              <a class="source" href="span.html">
                span.js
              </a>
            
              
              <a class="source" href="initChildNameSpaces.html">
                initChildNameSpaces.js
              </a>
            
              
              <a class="source" href="dataModel.html">
                dataModel.js
              </a>
            
              
              <a class="source" href="dataType.html">
                dataType.js
              </a>
            
              
              <a class="source" href="dataTypeCollection.html">
                dataTypeCollection.js
              </a>
            
              
              <a class="source" href="_selectionModel.html">
                _selectionModel.js
              </a>
            
              
              <a class="source" href="selectionModelCheckBox.html">
                selectionModelCheckBox.js
              </a>
            
              
              <a class="source" href="_selectionSubscribers.html">
                _selectionSubscribers.js
              </a>
            
              
              <a class="source" href="onDeselect.html">
                onDeselect.js
              </a>
            
              
              <a class="source" href="onSelect.html">
                onSelect.js
              </a>
            
              
              <a class="source" href="proxy.html">
                proxy.js
              </a>
            
              
              <a class="source" href="store.html">
                store.js
              </a>
            
              
              <a class="source" href="actionColumn.html">
                actionColumn.js
              </a>
            
              
              <a class="source" href="checkColumn.html">
                checkColumn.js
              </a>
            
              
              <a class="source" href="column.html">
                column.js
              </a>
            
              
              <a class="source" href="columnItem.html">
                columnItem.js
              </a>
            
              
              <a class="source" href="columns.html">
                columns.js
              </a>
            
              
              <a class="source" href="gridColumn.html">
                gridColumn.js
              </a>
            
              
              <a class="source" href="rendererColumn.html">
                rendererColumn.js
              </a>
            
              
              <a class="source" href="grid.html">
                grid.js
              </a>
            
              
              <a class="source" href="_gridSubscribers.html">
                _gridSubscribers.js
              </a>
            
              
              <a class="source" href="bodyscroll.html">
                bodyscroll.js
              </a>
            
              
              <a class="source" href="drop.html">
                drop.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="panel.html">
                panel.js
              </a>
            
              
              <a class="source" href="_panelSubscribers.html">
                _panelSubscribers.js
              </a>
            
              
              <a class="source" href="afterLayout.html">
                afterLayout.js
              </a>
            
              
              <a class="source" href="sheet.html">
                sheet.js
              </a>
            
              
              <a class="source" href="_sheetSubscribers.html">
                _sheetSubscribers.js
              </a>
            
              
              <a class="source" href="beforeclose.html">
                beforeclose.js
              </a>
            
              
              <a class="source" href="beforeshow.html">
                beforeshow.js
              </a>
            
              
              <a class="source" href="show.html">
                show.js
              </a>
            
              
              <a class="source" href="_structureSet.html">
                _structureSet.js
              </a>
            
              
              <a class="source" href="structureSet.html">
                structureSet.js
              </a>
            
              
              <a class="source" href="_treeSubscribers.html">
                _treeSubscribers.js
              </a>
            
              
              <a class="source" href="afterrender.html">
                afterrender.js
              </a>
            
              
              <a class="source" href="itemdbclick.html">
                itemdbclick.js
              </a>
            
              
              <a class="source" href="tree.html">
                tree.js
              </a>
            
              
              <a class="source" href="treeNode.html">
                treeNode.js
              </a>
            
              
              <a class="source" href="treeStore.html">
                treeStore.js
              </a>
            
              
              <a class="source" href="nameSpace.html">
                nameSpace.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>select.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/* global window:true, Ext:true */</span>

(<span class="keyword">function</span>(n$) {
    
    <span class="keyword">var</span> select = <span class="keyword">function</span>() {
        <span class="keyword">var</span> ret = n$.object();
        ret.add(<span class="string">'tables'</span>, n$.actions.sql.tables(ret));
        ret.add(<span class="string">'fields'</span>, n$.actions.sql.fields(ret));
        ret.add(<span class="string">'joins'</span>, n$.actions.sql.joins(ret));

        <span class="keyword">var</span> sortTablesByJoins = <span class="keyword">function</span>(tables, oUsedTables) {
            <span class="keyword">var</span> aTables = [], aJoins = [], oUsedTables = oUsedTables ||
                {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>loop over tables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, aCondition = [], aJoin, l = tables.length; i &lt; l; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>check if current table is a new one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (!oUsedTables.hasOwnProperty(tables[i].get(<span class="string">'id'</span>))) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>it is a new one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    aTables.push(tables[i]);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>mark table as used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    oUsedTables[tables[i].get(<span class="string">'id'</span>)] = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>get any joins for the current table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    aJoin = ret.joins.getJoinsByTableId(tables[i].get(<span class="string">'id'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>loop over the join tables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, joinTable, len = aJoin.length; j &lt; len; j++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>check if it is a new join</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">if</span> (!oUsedTables.hasOwnProperty(aJoin[j].get(<span class="string">'id'</span>))) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>mark join as used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            oUsedTables[aJoin[j].get(<span class="string">'id'</span>)] = <span class="literal">true</span>;
                            <span class="keyword">if</span> (tables[i].get(<span class="string">'id'</span>) != aJoin[j].get(<span class="string">'leftTableId'</span>)) {
                                joinTable = ret.tables.getTableById(aJoin[j].get(<span class="string">'leftTableId'</span>));
                                ret.changeLeftRightOnJoin(aJoin[j]);
                            } <span class="keyword">else</span> {
                                joinTable = ret.tables.getTableById(aJoin[j].get(<span class="string">'rightTableId'</span>));
                            }
                            oTemp = ret.sortTablesByJoins([joinTable], oUsedTables);
                            oUsedTables = oTemp.oUsedTables;
                            aTables = aTables.concat(oTemp.aTables);
                        }
                    }
                }
            }

            <span class="keyword">return</span> {
                aTables: aTables,
                oUsedTables: oUsedTables
            };
        };
        ret.add(<span class="string">'sortTablesByJoins'</span>, sortTablesByJoins);
        
        <span class="keyword">var</span> changeLeftRightOnJoin = <span class="keyword">function</span>(join) {
            <span class="keyword">var</span> leftTable, leftTableField, rightTable, rightTableField, joinCondition = <span class="string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>prepare new data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            leftTable = ret.tables.getTableById(join.get(<span class="string">'rightTableId'</span>));
            leftTableField = join.get(<span class="string">'rightTableField'</span>);
            rightTable = ret.tables.getTableById(join.get(<span class="string">'leftTableId'</span>));
            rightTableField = join.get(<span class="string">'leftTableField'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>construct new joinCondition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (leftTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                joinCondition = joinCondition + leftTable.get(<span class="string">'tableAlias'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'rightTableField'</span>) + <span class="string">'='</span>;
            } <span class="keyword">else</span> {
                joinCondition = joinCondition + leftTable.get(<span class="string">'tableName'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'rightTableField'</span>) + <span class="string">'='</span>;
            }

            <span class="keyword">if</span> (rightTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                joinCondition = joinCondition + rightTable.get(<span class="string">'tableAlias'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'leftTableField'</span>);
            } <span class="keyword">else</span> {
                joinCondition = joinCondition + rightTable.get(<span class="string">'tableName'</span>) + <span class="string">'.'</span> + join.get(<span class="string">'leftTableField'</span>);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>start transaction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.beginEdit();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>change left and right join table data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.set(<span class="string">'leftTableId'</span>, leftTable.get(<span class="string">'id'</span>));
            join.set(<span class="string">'leftTableField'</span>, leftTableField);
            join.set(<span class="string">'rightTableId'</span>, rightTable.get(<span class="string">'id'</span>));
            join.set(<span class="string">'rightTableField'</span>, rightTableField);
            join.set(<span class="string">'joinCondition'</span>, joinCondition);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>silent commit without firing store events
this prevents endless loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            join.commit(<span class="literal">true</span>);
            join.endEdit();</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>end transaction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span>;
        };
        ret.add(<span class="string">'changeLeftRightOnJoin'</span>, changeLeftRightOnJoin);

        <span class="keyword">var</span> arrayRemove = <span class="keyword">function</span>(array, filterProperty, filterValue) {
            <span class="keyword">var</span> aReturn;
            aReturn = Ext.Array.filter(array, <span class="keyword">function</span>(item) {
                <span class="keyword">var</span> bRemove = <span class="literal">true</span>;
                <span class="keyword">if</span> (item[filterProperty] == filtervalue) {
                    bRemove = <span class="literal">false</span>;
                }
                <span class="keyword">return</span> bRemove;
            });
            <span class="keyword">return</span> aReturn;
        };
        ret.add(<span class="string">'arrayRemove'</span>, arrayRemove);

        <span class="keyword">var</span> updateSQLOutput = <span class="keyword">function</span>() {
            <span class="keyword">var</span> sqlOutput, sqlHTML, sqlQutputPanel;
            sqlOutput = ret.sqlToString();
            sqlHTML = <span class="string">'&lt;pre class="brush: sql"&gt;'</span> + sqlOutput + <span class="string">'&lt;/pre&gt;'</span>;
            sqlQutputPanel = Ext.getCmp(<span class="string">'qbOutputPanel'</span>);

            sqlQutputPanel.update(sqlHTML);
        };
        ret.add(<span class="string">'updateSQLOutput'</span>, updateSQLOutput);

        <span class="keyword">var</span> sqlToString = <span class="keyword">function</span>() {
            <span class="keyword">var</span> sqlOutput = <span class="string">'SELECT '</span>,
                aJoins = [],
                aOutputFields = [],
                oJoinTables = {},
                aTables = [],
                aCriteriaFields = [],
                aGroupFields = [],
                aOrderFields = [],
                selectFieldsSQL = <span class="string">''</span>,
                fromSQL = <span class="string">''</span>,
                aFromSQL = [],
                criteriaSQL = <span class="string">''</span>,
                orderBySQL = <span class="string">''</span>,
                groupBySQL = <span class="string">''</span>,
                fieldSeperator = <span class="string">', '</span>,
                joinSQL = <span class="string">''</span>,
                bFirst = <span class="literal">true</span>;
            
            ret.fields.each(<span class="keyword">function</span>(field) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>should the field be a part of the output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (field.get(<span class="string">'output'</span>)) {
                    aOutputFields.push(field);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>any criteria</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (field.get(<span class="string">'criteria'</span>) != <span class="string">''</span>) {
                    aCriteriaFields.push(field);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>check for grouping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (field.get(<span class="string">'grouping'</span>)) {
                    aGroupFields.push(field);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>check for sorting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (field.get(<span class="string">'sortType'</span>) != <span class="string">''</span>) {
                    aOrderFields.push(field);
                }
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>tables
sorting of tables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ret.tables.each(<span class="keyword">function</span>(table) {
                aTables.push(table);
            });

            aTables = ret.sortTablesByJoins(aTables).aTables;


            ret.joins.each(<span class="keyword">function</span>(join) {
                aJoins.push(join);
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>create fromSQL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>, aJoin = [], oJoinTables = {}, joinCondition = <span class="string">''</span>, joinType, leftTable, rightTable, l = aTables.length; k &lt; l; k++) {
                <span class="keyword">if</span> (k == aTables.length - <span class="number">1</span>) {
                    fieldSeperator = <span class="string">''</span>;
                } <span class="keyword">else</span> {
                    fieldSeperator = <span class="string">', '</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>is the current table the first one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (bFirst) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>yes it is the first</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>table id merken</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    oJoinTables[aTables[k].get(<span class="string">'id'</span>)] = <span class="literal">true</span>;

                    bFirst = <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>check if current table is not the last one in the loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">if</span> ((k + <span class="number">1</span>) &lt; aTables.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>get joins where joins leftTableID is a property of oJoinTables and joins rightTableID equal to aTables[i+1].get(&#39;id&#39;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">for</span> (<span class="keyword">var</span> h = <span class="number">0</span>, len = aJoins.length; h &lt; len; h++) {
                            <span class="keyword">if</span> (oJoinTables.hasOwnProperty(aJoins[h].get(<span class="string">'leftTableId'</span>)) &amp;&amp; aJoins[h].get(<span class="string">'rightTableId'</span>) == aTables[k + <span class="number">1</span>].get(<span class="string">'id'</span>)) {
                                aJoin.push(aJoins[h]);
                            }
                            <span class="keyword">if</span> (oJoinTables.hasOwnProperty(aJoins[h].get(<span class="string">'rightTableId'</span>)) &amp;&amp; aJoins[h].get(<span class="string">'leftTableId'</span>) == aTables[k + <span class="number">1</span>].get(<span class="string">'id'</span>)) {
                                ret.changeLeftRightOnJoin(aJoins[h]);
                                aJoin.push(aJoins[h]);
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>check if we have a join</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">if</span> (aJoin.length &gt; <span class="number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>yes we have a join between aTables[k] and aTables[k+1] with at least one join condition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                            leftTable = aTables[k];
                            rightTable = aTables[k + <span class="number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>table id merken</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            oJoinTables[rightTable.get(<span class="string">'id'</span>)] = <span class="literal">true</span>;

                            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, fieldSeperator = <span class="string">''</span>, ln = aJoin.length; j &lt; ln; j++) {
                                <span class="keyword">if</span> (j == aJoin.length - <span class="number">1</span>) {
                                    fieldSeperator = <span class="string">''</span>;
                                } <span class="keyword">else</span> {
                                    fieldSeperator = <span class="string">'\nAND '</span>;
                                }
                                ;
                                joinType = aJoin[j].get(<span class="string">'joinType'</span>);
                                joinCondition = joinCondition + aJoin[j].get(<span class="string">'joinCondition'</span>) + fieldSeperator;
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>reset the join array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            aJoin = [];

                            <span class="keyword">if</span> (joinSQL != <span class="string">''</span>) {
                                joinSQL = joinSQL + <span class="string">',\n'</span>;
                            }

                            <span class="keyword">if</span> (leftTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>we have an leftTable alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + leftTable.get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + leftTable.get(<span class="string">'tableAlias'</span>) + <span class="string">' '</span> + joinType + <span class="string">' JOIN '</span>;
                            } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>no alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + leftTable.get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + joinType + <span class="string">' JOIN '</span>;
                            }

                            <span class="keyword">if</span> (rightTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>we have an rightTable alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + rightTable.get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + rightTable.get(<span class="string">'tableAlias'</span>) + <span class="string">' ON '</span> + joinCondition;
                            } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>no alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + rightTable.get(<span class="string">'tableName'</span>) + <span class="string">' ON '</span> + joinCondition;
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>clear joinCondition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            joinCondition = <span class="string">''</span>;

                        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>no join between aTables[i+1] and the one before</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            bFirst = <span class="literal">true</span>;
                            oJoinTables = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>check for tableAlias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="keyword">if</span> (aTables[k].get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                                fromSQL = aTables[k].get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + aTables[k].get(<span class="string">'tableAlias'</span>);
                            } <span class="keyword">else</span> {
                                fromSQL = aTables[k].get(<span class="string">'tableName'</span>);
                            }
                            aFromSQL.push(fromSQL);
                        }
                    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>its the last and only one in the loop
check for tableAlias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">if</span> (aTables[k].get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {
                            fromSQL = aTables[k].get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + aTables[k].get(<span class="string">'tableAlias'</span>);
                        } <span class="keyword">else</span> {
                            fromSQL = aTables[k].get(<span class="string">'tableName'</span>);
                        }
                        aFromSQL.push(fromSQL);
                    }
                } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>no, it is not the first table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    bFirst = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>check if current table is not the last one in the loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">if</span> ((k + <span class="number">1</span>) &lt; aTables.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>get joins where joins leftTableID is a property of oJoinTables and joins rightTableID equal to aTables[i+1].get(&#39;id&#39;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">for</span> (<span class="keyword">var</span> h = <span class="number">0</span>, len = aJoins.length; h &lt; len; h++) {
                            <span class="keyword">if</span> (oJoinTables.hasOwnProperty(aJoins[h].get(<span class="string">'leftTableId'</span>)) &amp;&amp; aJoins[h].get(<span class="string">'rightTableId'</span>) == aTables[k + <span class="number">1</span>].get(<span class="string">'id'</span>)) {
                                aJoin.push(aJoins[h]);
                            }
                            <span class="keyword">if</span> (oJoinTables.hasOwnProperty(aJoins[h].get(<span class="string">'rightTableId'</span>)) &amp;&amp; aJoins[h].get(<span class="string">'leftTableId'</span>) == aTables[k + <span class="number">1</span>].get(<span class="string">'id'</span>)) {
                                ret.changeLeftRightOnJoin(aJoins[h]);
                                aJoin.push(aJoins[h]);
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>check if we have a join</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">if</span> (aJoin.length &gt; <span class="number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>yes we have a join between aTables[k] and aTables[k+1] with at least one join condition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                            rightTable = aTables[k + <span class="number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>table id merken</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            oJoinTables[rightTable.get(<span class="string">'id'</span>)] = <span class="literal">true</span>;

                            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, fieldSeperator = <span class="string">''</span>, ln = aJoin.length; j &lt; ln; j++) {
                                <span class="keyword">if</span> (j == aJoin.length - <span class="number">1</span>) {
                                    fieldSeperator = <span class="string">''</span>;
                                } <span class="keyword">else</span> {
                                    fieldSeperator = <span class="string">'\nAND '</span>;
                                }
                                ;
                                joinType = aJoin[j].get(<span class="string">'joinType'</span>);
                                joinCondition = joinCondition + aJoin[j].get(<span class="string">'joinCondition'</span>) + fieldSeperator;
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>reset the join array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            aJoin = [];

                            bFirst = <span class="literal">false</span>;

                            <span class="keyword">if</span> (rightTable.get(<span class="string">'tableAlias'</span>) != <span class="string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>we have an rightTable alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + <span class="string">'\n'</span> + joinType + <span class="string">' JOIN '</span> + rightTable.get(<span class="string">'tableName'</span>) + <span class="string">' '</span> + rightTable.get(<span class="string">'tableAlias'</span>) + <span class="string">' ON '</span> + joinCondition;
                            } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>no alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                joinSQL = joinSQL + <span class="string">'\n'</span> + joinType + <span class="string">' JOIN '</span> + rightTable.get(<span class="string">'tableName'</span>) + <span class="string">' ON '</span> + joinCondition;
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>clear joinCondition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            joinCondition = <span class="string">''</span>;
                        } <span class="keyword">else</span> {
                            bFirst = <span class="literal">true</span>;
                            oJoinTables = {};
                        }
                    } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>its the last and only one
check for tableAlias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        oJoinTables = {};
                    }
                }
            }

            fromSQL = aFromSQL.join(<span class="string">', '</span>);

            <span class="keyword">if</span> (joinSQL != <span class="string">''</span> &amp;&amp; fromSQL != <span class="string">''</span>) {
                joinSQL = joinSQL + <span class="string">', '</span>;
            }

            fromSQL = <span class="string">'\nFROM '</span> + joinSQL + fromSQL;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>output fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> iOut = <span class="number">0</span>, l = aOutputFields.length; iOut &lt; l; iOut += <span class="number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>check if it is the last array member</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (iOut == aOutputFields.length - <span class="number">1</span>) {
                    fieldSeperator = <span class="string">''</span>;
                } <span class="keyword">else</span> {
                    fieldSeperator = <span class="string">', '</span>;
                }
                ;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>yes, output
check alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (aOutputFields[iOut].get(<span class="string">'alias'</span>) != <span class="string">''</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>yes, we have an field alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    selectFieldsSQL = selectFieldsSQL + aOutputFields[iOut].get(<span class="string">'expression'</span>) + <span class="string">' AS '</span> + aOutputFields[iOut].get(<span class="string">'alias'</span>) + fieldSeperator;
                } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>no field alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    selectFieldsSQL = selectFieldsSQL + aOutputFields[iOut].get(<span class="string">'expression'</span>) + fieldSeperator;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>criteria</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> iWhere = <span class="number">0</span>, l = aCriteriaFields.length; iWhere &lt; l; iWhere += <span class="number">1</span>) {
                <span class="keyword">if</span> (iWhere == <span class="number">0</span>) {
                    criteriaSQL = criteriaSQL + <span class="string">'\nWHERE '</span>;
                } <span class="keyword">else</span> {
                    criteriaSQL = criteriaSQL + <span class="string">'AND '</span>;
                }
                <span class="keyword">if</span> (iWhere == aCriteriaFields.length - <span class="number">1</span>) {
                    fieldSeperator = <span class="string">''</span>;
                } <span class="keyword">else</span> {
                    fieldSeperator = <span class="string">'\n'</span>;
                }
                criteriaSQL = criteriaSQL + aCriteriaFields[iWhere].get(<span class="string">'expression'</span>) + <span class="string">' '</span> + aCriteriaFields[iWhere].get(<span class="string">'criteria'</span>) + fieldSeperator;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>group by</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> iGroup = <span class="number">0</span>, l = aGroupFields.length; iGroup &lt; l; iGroup += <span class="number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>check if it is the last array member</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (iGroup == aGroupFields.length - <span class="number">1</span>) {
                    fieldSeperator = <span class="string">''</span>;
                } <span class="keyword">else</span> {
                    fieldSeperator = <span class="string">', '</span>;
                }
                <span class="keyword">if</span> (iGroup == <span class="number">0</span>) {
                    groupBySQL = <span class="string">'\nGROUP BY '</span>;
                }
                groupBySQL = groupBySQL + aGroupFields[iGroup].get(<span class="string">'expression'</span>) + fieldSeperator;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>order by</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">for</span> (<span class="keyword">var</span> iOrder = <span class="number">0</span>, l = aOrderFields.length; iOrder &lt; l; iOrder += <span class="number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>check if it is the last array member</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (iOrder == aOrderFields.length - <span class="number">1</span>) {
                    fieldSeperator = <span class="string">''</span>;
                } <span class="keyword">else</span> {
                    fieldSeperator = <span class="string">', '</span>;
                }
            }

            <span class="keyword">return</span> sqlOutput + selectFieldsSQL + fromSQL + criteriaSQL + groupBySQL + orderBySQL;
        };

        ret.add(<span class="string">'sqlToString'</span>, sqlToString);

        <span class="keyword">return</span> ret;
    };
    
    n$.actions.sql.register(<span class="string">'select'</span>, select);

}(window.$nameSpace$));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
