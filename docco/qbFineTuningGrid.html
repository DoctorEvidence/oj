<!DOCTYPE html>

<html>
<head>
  <title>qbFineTuningGrid.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="sqlBuilderInit.html">
                sqlBuilderInit.js
              </a>
            
              
              <a class="source" href="SqlDragDropTableJoinStore.html">
                SqlDragDropTableJoinStore.js
              </a>
            
              
              <a class="source" href="SqlTableJoinSprite.html">
                SqlTableJoinSprite.js
              </a>
            
              
              <a class="source" href="SqlTableNameStore.html">
                SqlTableNameStore.js
              </a>
            
              
              <a class="source" href="_initQbUI.html">
                _initQbUI.js
              </a>
            
              
              <a class="source" href="qbFineTuningGrid.html">
                qbFineTuningGrid.js
              </a>
            
              
              <a class="source" href="qbOutputPanel.html">
                qbOutputPanel.js
              </a>
            
              
              <a class="source" href="qbSqlWindowTable.html">
                qbSqlWindowTable.js
              </a>
            
              
              <a class="source" href="qbTableGrid.html">
                qbTableGrid.js
              </a>
            
              
              <a class="source" href="qbTablePanel.html">
                qbTablePanel.js
              </a>
            
              
              <a class="source" href="qbTablesTree.html">
                qbTablesTree.js
              </a>
            
              
              <a class="source" href="fields.html">
                fields.js
              </a>
            
              
              <a class="source" href="joins.html">
                joins.js
              </a>
            
              
              <a class="source" href="manager.html">
                manager.js
              </a>
            
              
              <a class="source" href="select.html">
                select.js
              </a>
            
              
              <a class="source" href="tables.html">
                tables.js
              </a>
            
              
              <a class="source" href="function.html">
                function.js
              </a>
            
              
              <a class="source" href="is.html">
                is.js
              </a>
            
              
              <a class="source" href="methods.html">
                methods.js
              </a>
            
              
              <a class="source" href="number.html">
                number.js
              </a>
            
              
              <a class="source" href="string.html">
                string.js
              </a>
            
              
              <a class="source" href="to.html">
                to.js
              </a>
            
              
              <a class="source" href="indexedDb.html">
                indexedDb.js
              </a>
            
              
              <a class="source" href="class.html">
                class.js
              </a>
            
              
              <a class="source" href="classDefinition.html">
                classDefinition.js
              </a>
            
              
              <a class="source" href="errors.html">
                errors.js
              </a>
            
              
              <a class="source" href="subscribers.html">
                subscribers.js
              </a>
            
              
              <a class="source" href="console.html">
                console.js
              </a>
            
              
              <a class="source" href="constant.html">
                constant.js
              </a>
            
              
              <a class="source" href="each.html">
                each.js
              </a>
            
              
              <a class="source" href="object.html">
                object.js
              </a>
            
              
              <a class="source" href="objectSql.html">
                objectSql.js
              </a>
            
              
              <a class="source" href="property.html">
                property.js
              </a>
            
              
              <a class="source" href="shims.html">
                shims.js
              </a>
            
              
              <a class="source" href="uuid.html">
                uuid.js
              </a>
            
              
              <a class="source" href="metaNode.html">
                metaNode.js
              </a>
            
              
              <a class="source" href="_nodeFactory.html">
                _nodeFactory.js
              </a>
            
              
              <a class="source" href="domNode.html">
                domNode.js
              </a>
            
              
              <a class="source" href="domNodeAttributes.html">
                domNodeAttributes.js
              </a>
            
              
              <a class="source" href="_element.html">
                _element.js
              </a>
            
              
              <a class="source" href="div.html">
                div.js
              </a>
            
              
              <a class="source" href="span.html">
                span.js
              </a>
            
              
              <a class="source" href="initChildNameSpaces.html">
                initChildNameSpaces.js
              </a>
            
              
              <a class="source" href="dataModel.html">
                dataModel.js
              </a>
            
              
              <a class="source" href="dataType.html">
                dataType.js
              </a>
            
              
              <a class="source" href="dataTypeCollection.html">
                dataTypeCollection.js
              </a>
            
              
              <a class="source" href="_selectionModel.html">
                _selectionModel.js
              </a>
            
              
              <a class="source" href="selectionModelCheckBox.html">
                selectionModelCheckBox.js
              </a>
            
              
              <a class="source" href="_selectionSubscribers.html">
                _selectionSubscribers.js
              </a>
            
              
              <a class="source" href="onDeselect.html">
                onDeselect.js
              </a>
            
              
              <a class="source" href="onSelect.html">
                onSelect.js
              </a>
            
              
              <a class="source" href="proxy.html">
                proxy.js
              </a>
            
              
              <a class="source" href="store.html">
                store.js
              </a>
            
              
              <a class="source" href="actionColumn.html">
                actionColumn.js
              </a>
            
              
              <a class="source" href="checkColumn.html">
                checkColumn.js
              </a>
            
              
              <a class="source" href="column.html">
                column.js
              </a>
            
              
              <a class="source" href="columnItem.html">
                columnItem.js
              </a>
            
              
              <a class="source" href="columns.html">
                columns.js
              </a>
            
              
              <a class="source" href="gridColumn.html">
                gridColumn.js
              </a>
            
              
              <a class="source" href="rendererColumn.html">
                rendererColumn.js
              </a>
            
              
              <a class="source" href="grid.html">
                grid.js
              </a>
            
              
              <a class="source" href="_gridSubscribers.html">
                _gridSubscribers.js
              </a>
            
              
              <a class="source" href="bodyscroll.html">
                bodyscroll.js
              </a>
            
              
              <a class="source" href="drop.html">
                drop.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="panel.html">
                panel.js
              </a>
            
              
              <a class="source" href="_panelSubscribers.html">
                _panelSubscribers.js
              </a>
            
              
              <a class="source" href="afterLayout.html">
                afterLayout.js
              </a>
            
              
              <a class="source" href="sheet.html">
                sheet.js
              </a>
            
              
              <a class="source" href="_sheetSubscribers.html">
                _sheetSubscribers.js
              </a>
            
              
              <a class="source" href="beforeclose.html">
                beforeclose.js
              </a>
            
              
              <a class="source" href="beforeshow.html">
                beforeshow.js
              </a>
            
              
              <a class="source" href="show.html">
                show.js
              </a>
            
              
              <a class="source" href="_structureSet.html">
                _structureSet.js
              </a>
            
              
              <a class="source" href="structureSet.html">
                structureSet.js
              </a>
            
              
              <a class="source" href="_treeSubscribers.html">
                _treeSubscribers.js
              </a>
            
              
              <a class="source" href="afterrender.html">
                afterrender.js
              </a>
            
              
              <a class="source" href="itemdbclick.html">
                itemdbclick.js
              </a>
            
              
              <a class="source" href="tree.html">
                tree.js
              </a>
            
              
              <a class="source" href="treeNode.html">
                treeNode.js
              </a>
            
              
              <a class="source" href="treeStore.html">
                treeStore.js
              </a>
            
              
              <a class="source" href="nameSpace.html">
                nameSpace.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>qbFineTuningGrid.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/* jshint undef: true, unused: true */</span>
<span class="comment">/* global n$:true, window:true, Ext:true, $: true */</span>

(<span class="keyword">function</span>(n$) {

    <span class="keyword">var</span> initFineTuningGrid = <span class="keyword">function</span>(gridDef) {

        <span class="comment">/**
          * Instance a collection of fields to describe a row in the SQL output table
        */</span>
        <span class="keyword">var</span> SqlFineTuningModel = n$.dataModels.dataModel({
            name: <span class="string">'Ext.'</span> + n$.name + <span class="string">'.SqlFineTuningModel'</span>,
            dataTypeCollection: [
                [<span class="string">'id'</span>],
                [<span class="string">'tableName'</span>],
                [<span class="string">'tableId'</span>],
                [<span class="string">'extCmpId'</span>],
                [<span class="string">'tableAlias'</span>],
                [<span class="string">'field'</span>],
                [<span class="string">'output'</span>, <span class="string">'boolean'</span>],
                [<span class="string">'expression'</span>],
                [<span class="string">'aggregate'</span>],
                [<span class="string">'alias'</span>],
                [<span class="string">'sortType'</span>],
                [<span class="string">'sortOrder'</span>],
                [<span class="string">'grouping'</span>, <span class="string">'boolean'</span>],
                [<span class="string">'criteria'</span>]
            ]
        });

        n$.actions.querybuilder.register(<span class="string">'SqlFineTuningModel'</span>, SqlFineTuningModel);

        <span class="comment">/**
         * Define the store
        */</span>
        <span class="keyword">var</span> SqlFineTuningStore = n$.stores.store({ name: <span class="string">'Ext.'</span> + n$.name + <span class="string">'.SqlFineTuningStore'</span>, dataModel: n$.actions.querybuilder.SqlFineTuningModel });

        <span class="comment">/**
         * Put the class into the namespace
        */</span>
        n$.actions.querybuilder.register(<span class="string">'SqlFineTuningStore'</span>, SqlFineTuningStore);


        <span class="comment">/**
         * Define the grid
        */</span>
        <span class="keyword">var</span> grid = n$.grids.grid({
            name: <span class="string">'Ext.'</span> + n$.name + <span class="string">'.qbFineTuningGrid'</span>,
            requires: [<span class="string">'Ext.ux.CheckColumn'</span>],
            id: <span class="string">'qbFineTuningGrid'</span>,
            store: <span class="string">'SqlFineTuningStore'</span>,<span class="comment">//new n$.actions.querybuilder.SqlFineTuningStore(),</span>
            alias: [<span class="string">'widget.qbFineTuningGrid'</span>],
            plugins: [window.Ext.create(<span class="string">'Ext.grid.plugin.CellEditing'</span>, {
                clicksToEdit: <span class="number">1</span>
            })],
            columnLines: <span class="literal">true</span>
        });

        <span class="comment">/**
         * Add the subscribers
        */</span>
        grid.subscribers.add(n$.grids.constants.subscribers.render, <span class="keyword">function</span>(view) {
            <span class="keyword">this</span>.dd = {};
            <span class="keyword">this</span>.dd.dropZone = <span class="keyword">new</span> Ext.grid.ViewDropZone({
                view: view,
                ddGroup: <span class="string">'SQLTableGridDDGroup'</span>,
                handleNodeDrop: <span class="keyword">function</span>(data, record, position) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>What should happen after the drop?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                }
            });
        })
            .add(n$.grids.constants.subscribers.drop, <span class="keyword">function</span>(node, data, dropRec, dropPosition) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>add new rows to the qbFineTuningGrid after a drop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                n$.each(data.records, <span class="keyword">function</span>(rec) {
                    n$.actions.sql.manager.select.fields.addFieldRecord(rec, <span class="literal">false</span>);
                });
            });

        <span class="comment">/**
         * Field Grid specific method
         * @param grid {Ext.grid.View} the grid
         * @param record {Object} The row in question
         * @param index {Number} The position of the row
         * @param direction {Number} The direction of movement
        */</span>
        <span class="keyword">var</span> moveGridRow = <span class="keyword">function</span>(grid, record, index, direction) {
            <span class="keyword">var</span> store = grid.getStore();
            <span class="keyword">if</span> (direction &lt; <span class="number">0</span>) {
                index--;
                <span class="keyword">if</span> (index &lt; <span class="number">0</span>) {
                    <span class="keyword">return</span>;
                }
            } <span class="keyword">else</span> {
                index++;
                <span class="keyword">if</span> (index &gt;= grid.getStore().getCount()) {
                    <span class="keyword">return</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>prepare manual syncing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            store.suspendAutoSync();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>disable firing store events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            store.suspendEvents();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>remove record and insert record at new index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            store.remove(record);
            store.insert(index, record);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>enable firing store events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            store.resumeEvents();
            store.resumeAutoSync();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>manual sync the store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            store.sync();
        };

        <span class="comment">/**
         * Define the action column
        */</span>
        <span class="keyword">var</span> actionColumn = n$.grids.columns.actionColumn(<span class="literal">false</span>, <span class="string">'Action'</span>, <span class="literal">true</span>);
        actionColumn.addItem(
            n$.grids.columns.columnItem(<span class="string">'img/up_arrow.gif'</span>, <span class="string">'Move Column Up'</span>, <span class="function"><span class="keyword">function</span> <span class="title">onGetClass</span><span class="params">(index)</span> {</span>
                <span class="keyword">return</span> index === <span class="number">0</span>;
            },
                <span class="function"><span class="keyword">function</span> <span class="title">onHandler</span><span class="params">(grid, rowIndex, colIndex)</span> {</span>
                    <span class="keyword">var</span> rec = grid.getStore().getAt(rowIndex);
                    moveGridRow(grid, rec, rowIndex, -<span class="number">1</span>);
                })
        ).addItem(
            n$.grids.columns.columnItem(<span class="string">'img/down_arrow.gif'</span>, <span class="string">'Move Column Down'</span>, <span class="function"><span class="keyword">function</span> <span class="title">onGetClass</span><span class="params">(index, store)</span> {</span>
                <span class="keyword">return</span> ((index + <span class="number">1</span>) == store.getCount());
            },
                <span class="function"><span class="keyword">function</span> <span class="title">onHandler</span><span class="params">(grid, rowIndex, colIndex)</span> {</span>
                    <span class="keyword">var</span> rec = grid.getStore().getAt(rowIndex);
                    moveGridRow(grid, rec, rowIndex, <span class="number">1</span>);
                })
        ).addItem(
            n$.grids.columns.columnItem(<span class="string">'img/remove.gif'</span>, <span class="string">'Remove Column'</span>, <span class="literal">null</span>, <span class="function"><span class="keyword">function</span> <span class="title">onHandler</span><span class="params">(grid, rowIndex, colIndex)</span> {</span>
                <span class="keyword">var</span> rec = grid.getStore().getAt(rowIndex),
                    store, tableId, tableGrid, selectionModel, bDel = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>rec contains column grid model, the one to remove
get tableId of original qbSqlWindowTable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                tableId = rec.get(<span class="string">'extCmpId'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>get the sql tables grid and its selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                tableGrid = Ext.getCmp(tableId).down(<span class="string">'gridpanel'</span>);
                selectionModel = tableGrid.getSelectionModel();
                Ext.Array.each(selectionModel.getSelection(), <span class="keyword">function</span>(selection) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>deselect the selection wich corresponds to the column
we want to remove from the column grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">if</span> (rec.get(<span class="string">'id'</span>) == selection.get(<span class="string">'id'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>deselect current selection
deselection will lead to removal, look for method deselect at the qbTableGrid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        selectionModel.deselect(selection);
                        bDel = <span class="literal">false</span>;
                    }
                });
                <span class="keyword">if</span> (bDel) {
                    store = grid.getStore();
                    store.remove(rec);
                }
            })
        );

        <span class="comment">/**
         * Define the columns
        */</span>
        grid.columnCollection.add(actionColumn)
            .add(n$.grids.columns.checkColumn(<span class="literal">false</span>, <span class="string">'Output'</span>, <span class="literal">true</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Expression'</span>, <span class="literal">true</span>, <span class="number">0.225</span>, <span class="string">'textfield'</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Aggregate'</span>, <span class="literal">true</span>, <span class="literal">null</span>, <span class="string">'textfield'</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Alias'</span>, <span class="literal">true</span>, <span class="literal">null</span>, <span class="string">'textfield'</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Sort Type'</span>, <span class="literal">true</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Sort Order'</span>, <span class="literal">true</span>))
            .add(n$.grids.columns.checkColumn(<span class="literal">false</span>, <span class="string">'Grouping'</span>, <span class="literal">true</span>))
            .add(n$.grids.columns.gridColumn(<span class="literal">false</span>, <span class="string">'Criteria'</span>, <span class="literal">true</span>, <span class="literal">null</span>, <span class="string">'textfield'</span>));

        <span class="comment">/**
         *Create the grid
        */</span>
        grid.init();

        <span class="keyword">return</span> {
            xtype: <span class="string">'qbFineTuningGrid'</span>,
            border: <span class="literal">false</span>,
            region: <span class="string">'south'</span>,
            height: <span class="number">120</span>,
            split: <span class="literal">true</span>
        };
    };
    
    n$.actions.querybuilder.register(<span class="string">'qbFineTuningGrid'</span>, initFineTuningGrid);

}(window.$nameSpace$));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
