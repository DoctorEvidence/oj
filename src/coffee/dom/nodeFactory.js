// Generated by CoffeeScript 1.7.1
(function() {
  (function(OJ) {
    var controlPostProcessing, extendChain, isChildNodeTypeAllowed, nestableNodeNames, nonNestableNodes;
    nestableNodeNames = ['div', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'fieldset', 'select', 'ol', 'ul', 'table'];
    nonNestableNodes = ['li', 'legend', 'tr', 'td', 'option', 'body', 'head', 'source', 'tbody', 'tfoot', 'thead', 'link', 'script'];
    isChildNodeTypeAllowed = function(parent, tagName) {
      var allowed;
      switch (parent.tagName) {
        case 'a':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'body':
          allowed = _.contains(nestableNodeNames, tagName);
          break;
        case 'div':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'form':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'label':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'legend':
          allowed = false;
          break;
        case 'fieldset':
          allowed = tagName === 'legend' || false === _.contains(nonNestableNodes, tagName);
          break;
        case 'ol':
          allowed = tagName === 'li';
          break;
        case 'ul':
          allowed = tagName === 'li';
          break;
        case 'li':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'table':
          allowed = tagName === 'td' || tagName === 'tr' || tagName === 'tbody';
          break;
        case 'td':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'select':
          allowed = tagName === 'option';
          break;
        case 'option':
          allowed = false;
          break;
        case 'span':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        case 'p':
          allowed = false === _.contains(nonNestableNodes, tagName);
          break;
        default:
          if (parent.tagName.startsWith('x-')) {
            allowed = false === _.contains(nonNestableNodes, tagName);
          } else {
            allowed = false;
          }
      }
      return allowed;
    };
    controlPostProcessing = function(control) {};

    /*
    Extend the chain, if permitted
     */
    extendChain = function(tagName, parent, child, count) {
      if (isChildNodeTypeAllowed(parent, tagName)) {
        return child.add(tagName, function(opts) {
          var nu;
          if (OJ.nodes[tagName]) {
            nu = OJ.nodes[tagName](opts, parent, true);
          } else {
            nu = OJ.custom(tagName, parent);
          }
          return OJ.nodes.factory(nu, parent, count);
        });
      }
    };
    OJ.nodes.register('factory', function(el, parent, count) {
      var init, ret;
      if (parent == null) {
        parent = OJ.body;
      }
      if (count == null) {
        count = parent.count || 0;
      }
      init = function(node) {
        var control, id;
        count += 1;
        if (el.tagName === 'body') {
          el.count = count;
          parent = null;
          el.root = null;
          control = OJ.dom(node, parent);
        } else {
          parent.count = count;
          control = OJ.dom(node, parent);
          if (!node.id) {
            id = parent.getId();
            id += control.tagName + count;
            control.attr('id', id);
          }
          parent.append(control[0]);
        }
        controlPostProcessing(control);
        return control;
      };
      ret = init(el);
      extendChain('a', el, ret, count);
      extendChain('b', el, ret, count);
      extendChain('br', el, ret, count);
      extendChain('button', el, ret, count);
      extendChain('div', el, ret, count);
      extendChain('fieldset', el, ret, count);
      extendChain('form', el, ret, count);
      extendChain('img', el, ret, count);
      extendChain('input', el, ret, count);
      extendChain('label', el, ret, count);
      extendChain('legend', el, ret, count);
      extendChain('li', el, ret, count);
      extendChain('ol', el, ret, count);
      extendChain('option', el, ret, count);
      extendChain('p', el, ret, count);
      extendChain('select', el, ret, count);
      extendChain('span', el, ret, count);
      extendChain('svg', el, ret, count);
      extendChain('table', el, ret, count);
      extendChain('textarea', el, ret, count);
      extendChain('ul', el, ret, count);
      return ret;
    });
  })((typeof global !== 'undefined' && global ? global : (typeof window !== 'undefined' ? window : this)).OJ);

}).call(this);

//# sourceMappingURL=nodeFactory.map
